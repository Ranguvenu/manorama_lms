{"version":3,"file":"schedule.min.js","sources":["../src/schedule.js"],"sourcesContent":["define(['jquery',\r\n    'core/ajax',\r\n    'block_learnerscript/ajax',\r\n    'core/event',\r\n    'block_learnerscript/select2',\r\n    'block_learnerscript/report',\r\n    'core/str'\r\n], function($, Ajax, ajax, Event, select2, report,Str) {\r\n\r\n    return schedule = {\r\n        /**\r\n         * To display scheduled timings for report\r\n         */\r\n        /**\r\n         * Schedule report form in popup in dashboard\r\n         * @param  object args reportid\r\n         * @return Popup with schedule form\r\n         */\r\n        schreportform: function(args) {\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_schreportform',\r\n                args: {\r\n                    // action: 'schreportform',\r\n                    reportid: args.reportid,\r\n                    instance: args.instanceid\r\n                },\r\n                // url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\"\r\n            }]);\r\n            promise[0].done(function(response) {\r\n                response = $.parseJSON(response);\r\n                $('body').append(\"<div class='schreportform\" + args.instanceid + \"'>\" + response + \"</div>\");\r\n                var title_img = \"<img class='dialog_title_icon' alt='Scheduled Report' src='\" +\r\n                    M.util.image_url(\"schedule_icon\", \"block_learnerscript\") + \"'/>\";\r\n                var dlg = $(\".schreportform\" + args.instanceid).dialog({\r\n                    resizable: true,\r\n                    autoOpen: false,\r\n                    width: \"90%\",\r\n                    title: 'Add schedule report',\r\n                    modal: true,\r\n                    appendTo: \"#inst\" + args.instanceid,\r\n                    position: {\r\n                        my: \"center\",\r\n                        at: \"center\",\r\n                        of: \"#reportcontainer\" + args.instanceid\r\n                    },\r\n                    open: function(event, ui) {\r\n                        $(this).closest(\".ui-dialog\").find(\".ui-dialog-titlebar-close\")\r\n                            .removeClass(\"ui-dialog-titlebar-close\")\r\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\r\n                            var Closebutton = $('.ui-icon-closethick').parent();\r\n                            $(Closebutton).attr({\r\n                                \"title\" : \"Close\"\r\n                            });\r\n                        $(this).closest(\".ui-dialog\").find('.ui-dialog-title')\r\n                            .html(title_img + 'Schedule report');\r\n                    },\r\n                    close: function(event, ui) {\r\n                        $(this).dialog('destroy').remove();\r\n                    }\r\n                });\r\n                dlg.dialog(\"open\");\r\n                $(\"#id_role\" + args.instanceid).select2();\r\n                this.SelectRoleUsers();\r\n                this.schformvalidation({\r\n                    reportid: args.reportid,\r\n                    form: 'schform' + args.instanceid,\r\n                    reqclass: 'schformreq' + args.instanceid,\r\n                    instanceid: args.instanceid\r\n                });\r\n            }).fail(function(ex) {\r\n                // do something with the exception\r\n                //  console.log(ex);\r\n            });\r\n        },\r\n        ScheduledTimings: function(args) {\r\n            $(\"select[data-select2='1']\").select2({\r\n                theme: \"classic\"\r\n            });\r\n            this.SelectRoleUsers();\r\n            $('#scheduledtimings').dataTable({\r\n                \"processing\": true,\r\n                \"serverSide\": true,\r\n                \"lengthMenu\": [\r\n                    [5, 10, 25, 50, -1],\r\n                    [5, 10, 25, 50, \"All\"]\r\n                ],\r\n                \"idisplaylength\": 5,\r\n                'ordering': false,\r\n                \"ajax\": {\r\n                    \"method\": \"GET\",\r\n                    \"url\": M.cfg.wwwroot + \"/blocks/learnerscript/components/scheduler/ajax.php\",\r\n                    \"data\": args\r\n                }\r\n            });\r\n        },\r\n        ViewSchUsersTable: function(args) {\r\n            $('#scheduledusers').dataTable({\r\n                \"processing\": true,\r\n                \"serverSide\": true,\r\n                \"lengthMenu\": [\r\n                    [5, 10, 25, 50, -1],\r\n                    [5, 10, 25, 50, \"All\"]\r\n                ],\r\n                \"idisplaylength\": 5,\r\n                'ordering': false,\r\n                \"ajax\": {\r\n                    \"method\": \"GET\",\r\n                    \"url\": M.cfg.wwwroot + \"/blocks/learnerscript/components/scheduler/ajax.php\",\r\n                    \"data\": {\r\n                        action: 'viewschusersdata',\r\n                        reportid: args.reportid,\r\n                        scheduleid: args.scheduleid,\r\n                        schuserslist: args.schuserslist\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        /**\r\n         * Add validation script to AJAX reponse MOODLE form\r\n         * @param  object args Form name and required classname\r\n         * @return {[type]}      [description]\r\n         */\r\n        schformvalidation: function(args) {\r\n            document.getElementById(args.form).addEventListener('submit', function(ev) {\r\n                try {\r\n                    var myValidator = report.validate_scheduled_reports_form(args);\r\n                } catch (e) {\r\n                    return true;\r\n                }\r\n                if (typeof window.tinyMCE !== 'undefined') {\r\n                    window.tinyMCE.triggerSave();\r\n                }\r\n                if (!myValidator) {\r\n                    ev.preventDefault();\r\n                }\r\n                return false;\r\n            });\r\n        },\r\n        /**\r\n         * Validates and return error message for each element of given form\r\n         * @param  object args Formname and required classname\r\n         * @return Returns list of error messages from validation\r\n         */\r\n        validate_scheduled_reports_form: function(args) {\r\n            var self = this;\r\n            if (skipClientValidation) {\r\n                $('.schreportform' + args.instanceid).dialog('destroy').remove();\r\n            }\r\n            var ret = true;\r\n            var frm = document.getElementById(args.form);\r\n            var first_focus = false;\r\n            $(\"[data-class='\" + args.reqclass + \"']\").each(function(index, value) {\r\n                var element = $(value).data('element');\r\n                ret = self.validate_scheduled_reports_form_element(value, element, args) && ret;\r\n                if (!ret && !first_focus) {\r\n                    first_focus = true;\r\n                    Y.use('moodle-core-event', function() {\r\n                        Y.Global.fire(M.core.globalEvents.FORM_ERROR, {\r\n                            formid: args.form,\r\n                            elementid: 'id_error_' + element + args.instanceid\r\n                        });\r\n                        document.getElementById('id_error_' + element + args.instanceid).focus();\r\n                    });\r\n                }\r\n            });\r\n            return ret;\r\n        },\r\n        /**\r\n         * Format error message string for each element\r\n         * @param  object element Element object\r\n         * @param  string escapedName Element name\r\n         * @return Formatted error messages for each element\r\n         */\r\n        validate_scheduled_reports_form_element: function(element, escapedName, args) {\r\n            if (undefined == element) {\r\n                //required element was not found, then let form be submitted without client side validation\r\n                return true;\r\n            }\r\n            var value = '';\r\n            var errFlag = new Array();\r\n            var _qfGroups = {};\r\n            var _qfMsg = '';\r\n            var frm = element.parentNode;\r\n            if ((undefined != element.name) && (frm != undefined)) {\r\n                while (frm && frm.nodeName.toUpperCase() != 'FORM') {\r\n                    frm = frm.parentNode;\r\n                }\r\n                value = new Array();\r\n                var valueIdx = 0;\r\n                for (var i = 0; i < element.options.length; i++) {\r\n                    if (element.options[i].selected) {\r\n                        value[valueIdx++] = element.options[i].value;\r\n                    }\r\n                }\r\n                if (value == '' && !errFlag[escapedName]) {\r\n                    errFlag[escapedName] = true;\r\n                    _qfMsg = _qfMsg + ' - You must supply a value here.';\r\n                }\r\n                return this.qf_errorHandler(element, _qfMsg, escapedName, args);\r\n            } else {\r\n                //element name should be defined else error msg will not be displayed.\r\n                return true;\r\n            }\r\n        },\r\n        /**\r\n         * Render and display error message for each element\r\n         * @param  object element  Element object\r\n         * @param  string _qfMsg  Error message\r\n         * @param  string escapedName Element name\r\n         * @return Render and display error message for each element\r\n         */\r\n        qf_errorHandler: function(element, _qfMsg, escapedName, args) {\r\n            var event = $.Event(Event.Events.FORM_FIELD_VALIDATION);\r\n            $(element).trigger(event, _qfMsg);\r\n            if (event.isDefaultPrevented()) {\r\n                return _qfMsg == '';\r\n            } else {\r\n                // Legacy mforms.\r\n                var div = element.parentNode;\r\n                if ((div == undefined) || (element.name == undefined)) {\r\n                    // No checking can be done for undefined elements so let server handle it.\r\n                    return true;\r\n                }\r\n                if (_qfMsg != '') {\r\n                    var errorSpan = document.getElementById('id_error_' + escapedName + args.instanceid);\r\n                    if (!errorSpan) {\r\n                        errorSpan = document.createElement('span');\r\n                        errorSpan.id = 'id_error_' + escapedName + args.instanceid;\r\n                        errorSpan.className = 'error';\r\n                        element.parentNode.insertBefore(errorSpan, element.parentNode.firstChild);\r\n                        document.getElementById(errorSpan.id).setAttribute('TabIndex', '0');\r\n                        document.getElementById(errorSpan.id).focus();\r\n                    }\r\n                    while (errorSpan.firstChild) {\r\n                        errorSpan.removeChild(errorSpan.firstChild);\r\n                    }\r\n                    errorSpan.appendChild(document.createTextNode(_qfMsg.substring(3)));\r\n                    if (div.className.substr(div.className.length - 6, 6) != ' error' && div.className != 'error') {\r\n                        div.className += ' error';\r\n                        linebreak = document.createElement('br');\r\n                        linebreak.className = 'error';\r\n                        linebreak.id = 'id_error_break_' + escapedName + args.instanceid;\r\n                        errorSpan.parentNode.insertBefore(linebreak, errorSpan.nextSibling);\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    var errorSpan = document.getElementById('id_error_' + escapedName + args.instanceid);\r\n                    if (errorSpan) {\r\n                        errorSpan.parentNode.removeChild(errorSpan);\r\n                    }\r\n                    var linebreak = document.getElementById('id_error_break_' + escapedName + args.instanceid);\r\n                    if (linebreak) {\r\n                        linebreak.parentNode.removeChild(linebreak);\r\n                    }\r\n                    if (div.className.substr(div.className.length - 6, 6) == ' error') {\r\n                        div.className = div.className.substr(0, div.className.length - 6);\r\n                    } else if (div.className == 'error') {\r\n                        div.className = '';\r\n                    }\r\n                    return true;\r\n                }\r\n            }\r\n        },\r\n        frequency_schedule: function(args) {\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_frequency_schedule',\r\n                args: {\r\n                    frequency: $(\"#id_frequency\" + args.reportinstance).val()\r\n                    // action: 'frequency_schedule'\r\n                }\r\n            }]);\r\n            promise[0].done(function(resp) {\r\n                resp = $.parseJSON(resp);\r\n                var template = '';\r\n                if (resp) {\r\n                    $.each(resp, function(index, value) {\r\n                        template += '<option value = ' + index + ' >' + value + '</option>';\r\n                    });\r\n                } else {\r\n                    template += '<option value=null > --SELECT-- </option>';\r\n                }\r\n                $(\"#id_updatefrequency\" + args.reportinstance).html(template);\r\n            }).fail(function(ex) {\r\n                // do something with the exception\r\n                //  console.log(ex);\r\n            });\r\n        },\r\n        /**\r\n         * Manage more users to schedule report\r\n         * @param  object args reportid,scheduleid,selectedroleid and userslist\r\n         * @return Display popup with manage users for scheduled/Scheduling report\r\n         */\r\n        manageschusers: function(args) {\r\n            Str.get_string('manageschusers','block_learnerscript').then(function(s) {\r\n            var promise = Ajax.call([{\r\n                methodname: 'block_learnerscript_manageschusers',\r\n                args: {\r\n                    // action: 'manageschusers',\r\n                    reportid: args.reportid,\r\n                    scheduleid: args.scheduleid,\r\n                    selectedroleid: JSON.stringify(args.selectedroleid),\r\n                    // selectedroleid: args.selectedroleid,\r\n                    schuserslist: args.schuserslist,\r\n                    reportinstance: args.reportinstance\r\n                }\r\n                // url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\"\r\n            }]);\r\n\r\n            promise[0].done(function(response) {\r\n                response = $.parseJSON(response);\r\n                $('body').append(\"<div class='manageschusers'>\" + response + \"</div>\");\r\n                var bodyattb = $('body').attr('id');\r\n                var position, my, at;\r\n                if(bodyattb == 'page-blocks-learnerscript-components-scheduler-schedule'){\r\n                    position = '#scheduleform';\r\n                    my = \"center top\";\r\n                    at = \"center top\";\r\n                }else{\r\n                    position = window;\r\n                    my = \"center\";\r\n                    at = \"center\";\r\n                    var cid = $(\".manageschusers\").addClass('notschuserspage');\r\n                }                       \r\n                var dlg = $(\".manageschusers\").dialog({\r\n                    resizable: true,\r\n                    autoOpen: false,\r\n                    width: \"60%\",\r\n                    title: 'Manage Schedule Users',\r\n                    modal: true,\r\n                    position: {\r\n                        my: my,\r\n                        at: at,\r\n                        of: position,\r\n                        within: position\r\n                    },\r\n                    close: function(event, ui) {\r\n                        $(this).dialog('destroy').remove();\r\n                    },\r\n                    open: function() {\r\n                        $(this).closest(\".ui-dialog\")\r\n                            .find(\".ui-dialog-titlebar-close\")\r\n                            .removeClass(\"ui-dialog-titlebar-close\")\r\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\r\n                            var Closebutton = $('.ui-icon-closethick').parent();\r\n                            $(Closebutton).attr({\r\n                                \"title\" : \"Close\"\r\n                            });\r\n                        // $(this).closest(\".ui-dialog\")\r\n                        //     .find('.ui-dialog-title').html(title_img + self.args.title);\r\n                    }\r\n                });\r\n                if($(\".manageschusers\").hasClass(\"notschuserspage\")){\r\n                    var parentdialog = $(\".manageschusers\").parent();\r\n                    parentdialog.addClass('notinschpage');\r\n                }\r\n                // dlg.closest(\".ui-dialog\").draggable({containment: \"parent\"});\r\n                $(\".selectrole\" + args.reportid).select2();\r\n                dlg.dialog(\"open\");\r\n            }).fail(function(ex) {\r\n                // do something with the exception\r\n                //  console.log(ex);\r\n            });\r\n        });\r\n        },\r\n        /**\r\n         * Get users for selected roles in bulk user form while searching\r\n         * @param  object args reportid and selected roles\r\n         * @return object List of users for selected roles\r\n         */\r\n        getroleusers: function(args) {\r\n            var roles = $('.selectrole' + args.reportid).val();\r\n            this.validate_scheduled_reports_form({\r\n                reportid: args.reportid,\r\n                form: 'assignform',\r\n                reqclass: 'rolereq'\r\n            });\r\n            var bullkselectedusers = $('.removeselect').val();\r\n            if ($('#addselect_searchtext').val().length < 1) {\r\n                template = \"<optgroup label='Enter a value in search.'></optgroup>\";\r\n                $('#' + args.type + 'select' + args.reportid).html(template);\r\n            } else {\r\n                var roleid = roles.split('_');\r\n                args.roleid = roleid[0];\r\n                args.contextlevel = roleid[1];\r\n                var promise = Ajax.call([{\r\n                    methodname: 'block_learnerscript_roleusers',\r\n                    args: {\r\n                        // action: 'roleusers',\r\n                        term: $('#addselect_searchtext').val(),\r\n                        type: args.type,\r\n                        reportid: args.reportid,\r\n                        roleid: args.roleid,\r\n                        contextlevel: args.contextlevel,\r\n                        scheduleid: args.scheduleid,\r\n                        bullkselectedusers: JSON.stringify(bullkselectedusers)\r\n                    },\r\n                    // url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\"\r\n                }]);\r\n                promise[0].done(function(response) {\r\n                    var template = '';\r\n                    response = $.parseJSON(response);\r\n                    if (response.total_count > 0) {\r\n                        $.each(response.items, function(index, value) {\r\n                            template += '<option value = ' + value.id + ' >' + value.fullname + '</option>';\r\n                        });\r\n                    } else {\r\n                        template += \"<optgroup label='No results found.'></optgroup>\";\r\n                    }\r\n                    $('#' + args.type + 'select' + args.reportid).html(template);\r\n                }).fail(function(ex) {\r\n                    // do something with the exception\r\n                    // console.log(ex);\r\n                });\r\n            }\r\n        },\r\n        /**\r\n         * Add/remove bulk users to schedule reports\r\n         * @param  object args reportid\r\n         * @return Add/remove users to schedule report form\r\n         */\r\n        bulkmanageschusers: function(args) {\r\n            var bullkselectedusers = $.map($('.removeselect option'), function(e) {\r\n                return e.value;\r\n            });\r\n            $('#schuserslist' + args.reportinstance).val(bullkselectedusers);\r\n            var selectedusers = $('.removeselect').find('option').clone();\r\n            $('#id_users_data' + args.reportinstance).children('option').remove();\r\n            if (selectedusers.length > 10) {\r\n                var tenusers = selectedusers.slice(0, 10);\r\n                tenusers.attr('selected', 'selected').appendTo('#id_users_data' + args.reportinstance);\r\n                var opt = document.createElement('option');\r\n                opt.value = '-1';\r\n                opt.innerHTML = 'View More';\r\n                opt.selected = true;\r\n                document.getElementById('id_users_data' + args.reportinstance).appendChild(opt);\r\n            } else {\r\n                $('.removeselect').find('option').clone().attr('selected', 'selected').appendTo('#id_users_data' + args.reportinstance);\r\n            }\r\n            $('.manageschusers').dialog('close');\r\n        },\r\n        /**\r\n         * Preview selected users to schedule report\r\n         * @param  object args reportid,scheduleid and userslist\r\n         * @return Preview users in dialog\r\n         */\r\n        viewschusers: function(args) {\r\n            Str.get_string('viewschusers','block_learnerscript').then(function(s) {\r\n                var self = this;\r\n                args.schuserslist = $('#schuserslist' + args.reportinstance).val();\r\n                var promise = ajax.call({\r\n                    methodname: 'viewschuserstable',\r\n                    args: {\r\n                        action: 'viewschuserstable',\r\n                        reportid: args.reportid,\r\n                        scheduleid: args.scheduleid,\r\n                        schuserslist: args.schuserslist\r\n                    },\r\n                    url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\",\r\n                });\r\n                promise.done(function(response) {\r\n                    $('body').append(\"<div class='viewschuserstable'>\" + response + \"</div>\");\r\n                    var dlg = $(\".viewschuserstable\").dialog({\r\n                        resizable: true,\r\n                        autoOpen: false,\r\n                        width: \"60%\",\r\n                        title: 'View Scheduled Users',\r\n                        modal: true,\r\n                        close: function(event, ui) {\r\n                            $(this).dialog('destroy').remove();\r\n                        },\r\n                        open: function() {\r\n                            $(this).closest(\".ui-dialog\")\r\n                                .find(\".ui-dialog-titlebar-close\")\r\n                                .removeClass(\"ui-dialog-titlebar-close\")\r\n                                .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\r\n                                var Closebutton = $('.ui-icon-closethick').parent();\r\n                                $(Closebutton).attr({\r\n                                    \"title\" : \"Close\"\r\n                                });\r\n                            // $(this).closest(\".ui-dialog\")\r\n                            //     .find('.ui-dialog-title').html(title_img + self.args.title);\r\n                        }\r\n                    });\r\n                    schedule.ViewSchUsersTable(args);\r\n                    dlg.dialog(\"open\").prev(\".ui-dialog-titlebar\").css(\"color\", \"#0C75B6\");\r\n                }).fail(function(ex) {\r\n                    // do something with the exception\r\n                    //console.log(ex);\r\n                });\r\n            });\r\n        },\r\n        /**\r\n         * Add users to schedule report\r\n         * @param  object args reportid\r\n         * @return Adds users to schedule report form\r\n         */\r\n        addschusers: function(args) {\r\n            var selschusers = $('.schforms' + args.reportinstance + ' #id_users_data' + args.reportinstance).val();\r\n            var selusers = $('.schforms' + args.reportinstance + ' #schuserslist' + args.reportinstance).val();\r\n            var total;\r\n            if (selusers) {\r\n                selusers = selusers.split(',');\r\n                total = selusers.concat(selschusers);\r\n            } else {\r\n                total = selschusers;\r\n            }\r\n            if (total && total.includes('-1')) {\r\n                var index = total.indexOf('-1');\r\n                total.splice(index, 1);\r\n            }\r\n            $('#id_users_data' + args.reportinstance).find('option').not(':selected').each(function(k, v) {\r\n                if (total && total.includes(v.value)) {\r\n                    var index = total.indexOf(v.value);\r\n                    total.splice(index, 1);\r\n                }\r\n            });\r\n            var d = total && total.filter(function(item, pos) {\r\n                return total.indexOf(item) == pos;\r\n            });\r\n            $('#schuserslist' + args.reportinstance).val(d);\r\n        },\r\n        /**\r\n         * Get roleusers for selected report\r\n         */\r\n        SelectRoleUsers: function() {\r\n            var reportid = $(\".schform\").data('reportid');\r\n            require(['block_learnerscript/helper'], function(helper) {\r\n                helper.Select2Ajax({\r\n                    reportid: reportid,\r\n                    action: 'rolewiseusers',\r\n                    maximumSelectionLength: 10\r\n                });\r\n            })\r\n        },\r\n        rolewiseusers: function(args) {\r\n            $('#id_users_data' + args.reportinstance).val(null).trigger('change');\r\n        }\r\n    }\r\n});"],"names":["define","$","Ajax","ajax","Event","select2","report","Str","schedule","schreportform","args","call","methodname","reportid","instance","instanceid","done","response","parseJSON","append","title_img","M","util","image_url","dialog","resizable","autoOpen","width","title","modal","appendTo","position","my","at","of","open","event","ui","this","closest","find","removeClass","html","Closebutton","parent","attr","close","remove","SelectRoleUsers","schformvalidation","form","reqclass","fail","ex","ScheduledTimings","theme","dataTable","cfg","wwwroot","ViewSchUsersTable","action","scheduleid","schuserslist","document","getElementById","addEventListener","ev","myValidator","validate_scheduled_reports_form","e","window","tinyMCE","triggerSave","preventDefault","self","skipClientValidation","ret","first_focus","each","index","value","element","data","validate_scheduled_reports_form_element","Y","use","Global","fire","core","globalEvents","FORM_ERROR","formid","elementid","focus","escapedName","undefined","errFlag","Array","_qfMsg","frm","parentNode","name","nodeName","toUpperCase","valueIdx","i","options","length","selected","qf_errorHandler","Events","FORM_FIELD_VALIDATION","trigger","isDefaultPrevented","div","errorSpan","createElement","id","className","insertBefore","firstChild","setAttribute","removeChild","appendChild","createTextNode","substring","substr","linebreak","nextSibling","frequency_schedule","frequency","reportinstance","val","resp","template","manageschusers","get_string","then","s","selectedroleid","JSON","stringify","addClass","dlg","within","hasClass","getroleusers","roles","bullkselectedusers","type","roleid","split","contextlevel","term","total_count","items","fullname","bulkmanageschusers","map","selectedusers","clone","children","slice","opt","innerHTML","viewschusers","url","prev","css","addschusers","total","selschusers","selusers","concat","includes","indexOf","splice","not","k","v","d","filter","item","pos","require","helper","Select2Ajax","maximumSelectionLength","rolewiseusers"],"mappings":"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"}