{"version":3,"file":"customgoals.min.js","sources":["../src/customgoals.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for the hirarchy in goals page.\n *\n * @module     local_goals/customgoals\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport homepage from 'theme_horizon/homepage';\n\n/**\n * Selectors\n */\nconst Selectors = {\n    actions: {\n        creategoal: '[data-action = \"creategoal\"]',\n        createboard: '[data-action=\"createboard\"]',\n        createclass: '[data-action=\"createclass\"]',\n        createsubject: '[data-action=\"createsubject\"]',\n        deletecomponent: '[data-action=\"deletecomponent\"]',\n    },\n};\n\n/**\n * Initialize module\n */\nlet HomePage = new homepage();\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let creategoal = e.target.closest(Selectors.actions.creategoal);\n        if (creategoal) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = creategoal.getAttribute('data-id') ?\n                getString('edit_goal', 'local_goals', creategoal.getAttribute('data-name')) :\n                getString('add_goal', 'local_goals');\n            const form = new ModalForm({\n                formClass: 'local_goals\\\\form\\\\customgoal',\n                args: {id: creategoal.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: creategoal,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createboard = e.target.closest(Selectors.actions.createboard);\n        if (createboard) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createboard.getAttribute('data-id') ?\n                getString('edit_board', 'local_goals', createboard.getAttribute('data-name')) :\n                getString('add_board', 'local_goals', createboard.getAttribute('data-goalname'));\n            const form = new ModalForm({\n                formClass: 'local_goals\\\\form\\\\customboard',\n                args: {id: createboard.getAttribute('data-id'),goalid: createboard.getAttribute('data-goalid')},\n                modalConfig: {title},\n                returnFocus: createboard,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createclass = e.target.closest(Selectors.actions.createclass);\n        if (createclass) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createclass.getAttribute('data-id') ?\n                getString('edit_class', 'local_goals', createclass.getAttribute('data-name')) :\n                getString('add_class', 'local_goals', createclass.getAttribute('data-boardname'));\n        \n            const form = new ModalForm({\n                formClass: 'local_goals\\\\form\\\\customclass',\n                args: {id: createclass.getAttribute('data-id'),boardid: createclass.getAttribute('data-boardid')},\n                modalConfig: {title},\n                returnFocus: createclass,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createsubject = e.target.closest(Selectors.actions.createsubject);\n        if (createsubject) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createsubject.getAttribute('data-id') ?\n                getString('edit_subject', 'local_goals', createsubject.getAttribute('data-name')) :\n                getString('add_subject', 'local_goals', createsubject.getAttribute('data-classessname'));\n        \n            const form = new ModalForm({\n                formClass: 'local_goals\\\\form\\\\customsubject',\n                args: {id: createsubject.getAttribute('data-id'),classessid: createsubject.getAttribute('data-classessid')},\n                modalConfig: {title},\n                returnFocus: createsubject,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        deletecomponent = e.target.closest(Selectors.actions.deletecomponent);\n        if (deletecomponent) {\n            const component = deletecomponent.getAttribute('data-component');\n            const id = deletecomponent.getAttribute('data-id');\n            const name = deletecomponent.getAttribute('data-name');\n            const code = deletecomponent.getAttribute('data-code');\n            var displayparams = {};\n            displayparams.component = component;\n            displayparams.name = name;\n            displayparams.code = code;\n            ModalFactory.create({\n                title: getString('deletecomponentconfirm', 'local_goals',component),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletecomponentbodymessage', 'local_goals', displayparams)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_goals'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var sparams = {};\n                    sparams.id = id;\n                    sparams.component = component;\n                    var promise = Ajax.call([{\n                        methodname: 'local_goals_candeletecomponent',\n                        args: sparams\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_goals'));\n                        } else {\n                            var params = {};\n                            params.id = id;\n                            params.component = component;\n                            var promise = Ajax.call([{\n                                methodname: 'local_goals_deletecomponent',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                // do something with the exception\n                                console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                    \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n    });\n};\n"],"names":["Selectors","creategoal","createboard","createclass","createsubject","deletecomponent","HomePage","homepage","document","addEventListener","e","target","closest","preventDefault","stopImmediatePropagation","title","getAttribute","form","ModalForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","goalid","boardid","classessid","component","name","code","displayparams","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","sparams","Ajax","call","methodname","resp","candelete","hide","confirmbox","params","fail","console","log","bind","this"],"mappings":"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"}