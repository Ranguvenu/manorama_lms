{"version":3,"file":"customunits.min.js","sources":["../src/customunits.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for the hirarchy in units page.\n *\n * @module     local_units/customunits\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport homepage from 'theme_horizon/homepage';\n\n/**\n * Selectors\n */\nconst Selectors = {\n    actions: {\n        createunit: '[data-action = \"createunit\"]',\n        createchapter: '[data-action=\"createchapter\"]',\n        createtopic: '[data-action=\"createtopic\"]',\n        createconcept: '[data-action=\"createconcept\"]',\n        deletecomponent: '[data-action=\"deletecomponent\"]',\n    },\n};\n\n/**\n * Initialize module\n */\nlet HomePage = new homepage();\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let createunit = e.target.closest(Selectors.actions.createunit);\n        if (createunit) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createunit.getAttribute('data-id') ?\n                getString('edit_unit', 'local_units', createunit.getAttribute('data-name')) :\n                getString('add_unit', 'local_units');\n            const form = new ModalForm({\n                formClass: 'local_units\\\\form\\\\customunit',\n                args: {id: createunit.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: createunit,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createchapter = e.target.closest(Selectors.actions.createchapter);\n        if (createchapter) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createchapter.getAttribute('data-id') ?\n                getString('edit_chapter', 'local_units', createchapter.getAttribute('data-name')) :\n                getString('add_chapter', 'local_units', createchapter.getAttribute('data-unitname'));\n            const form = new ModalForm({\n                formClass: 'local_units\\\\form\\\\customchapter',\n                args: {id: createchapter.getAttribute('data-id'),unitid: createchapter.getAttribute('data-unitid')},\n                modalConfig: {title},\n                returnFocus: createchapter,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createtopic = e.target.closest(Selectors.actions.createtopic);\n        if (createtopic) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createtopic.getAttribute('data-id') ?\n                getString('edit_topic', 'local_units', createtopic.getAttribute('data-name')) :\n                getString('add_topic', 'local_units', createtopic.getAttribute('data-chaptername'));\n        \n            const form = new ModalForm({\n                formClass: 'local_units\\\\form\\\\customtopic',\n                args: {id: createtopic.getAttribute('data-id'),chapterid: createtopic.getAttribute('data-chapterid'),unitid: createtopic.getAttribute('data-unitid')},\n                modalConfig: {title},\n                returnFocus: createtopic,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        createconcept = e.target.closest(Selectors.actions.createconcept);\n        if (createconcept) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = createconcept.getAttribute('data-id') ?\n                getString('edit_concept', 'local_units', createconcept.getAttribute('data-name')) :\n                getString('add_concept', 'local_units', createconcept.getAttribute('data-conceptname'));\n        \n            const form = new ModalForm({\n                formClass: 'local_units\\\\form\\\\customconcept',\n                args: {id: createconcept.getAttribute('data-id'),chapterid: createconcept.getAttribute('data-chapterid'),unitid: createconcept.getAttribute('data-unitid'),topicid: createconcept.getAttribute('data-topicid')},\n                modalConfig: {title},\n                returnFocus: createconcept,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n\n        deletecomponent = e.target.closest(Selectors.actions.deletecomponent);\n        if (deletecomponent) {\n            const component = deletecomponent.getAttribute('data-component');\n            const id = deletecomponent.getAttribute('data-id');\n            const name = deletecomponent.getAttribute('data-name');\n            const code = deletecomponent.getAttribute('data-code');\n            var displayparams = {};\n            displayparams.component = component;\n            displayparams.name = name;\n            displayparams.code = code;\n            ModalFactory.create({\n                title: getString('deletecomponentconfirm', 'local_units',component),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletecomponentbodymessage', 'local_units', displayparams)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_units'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var sparams = {};\n                    sparams.id = id;\n                    sparams.component = component;\n                    var promise = Ajax.call([{\n                        methodname: 'local_units_candeletecomponent',\n                        args: sparams\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_units'));\n                        } else {\n                            var params = {};\n                            params.id = id;\n                            params.component = component;\n                            var promise = Ajax.call([{\n                                methodname: 'local_units_deletecomponent',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                // do something with the exception\n                                console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                    \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n    });\n};\n"],"names":["Selectors","createunit","createchapter","createtopic","createconcept","deletecomponent","HomePage","homepage","document","addEventListener","e","target","closest","preventDefault","stopImmediatePropagation","title","getAttribute","form","ModalForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","unitid","chapterid","topicid","component","name","code","displayparams","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","sparams","Ajax","call","methodname","resp","candelete","hide","confirmbox","params","fail","console","log","bind","this"],"mappings":"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"}