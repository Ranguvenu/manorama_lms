{"version":3,"file":"session.min.js","sources":["../src/session.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module session\n *\n * @module     local_packages/session\n * @copyright  2023 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nconst Selectors = {\n    actions: {\n        addsessions: '[data-action=\"addsessions\"]',\n        viewsessions: '[data-action=\"viewsessions\"]',\n        deletesession: '[data-action=\"deletesession\"]',\n    },\n};\nconst render_template = (template, selector, params, append = false) => {\n\tif(!append){\n\t\t$(selector).empty();\n\t}\n\tTemplates.renderForPromise(template, params).then(({html, js}) => {\n\t\tTemplates.appendNodeContents(selector, html, js);\n\t});\t\n}\nconst loader = (selector, isloading, append = false) => {\n\tif(isloading){\n\t\trender_template('local_packages/loader', selector, {}, append);\n\t}else{\n\t\t$(\"[data-region='page-loader']\").remove();\n\t}\n}\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let element = e.target.closest(Selectors.actions.addsessions);\n        if (element) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = element.getAttribute('data-id') ?\n                getString('updatesession', 'local_packages') :\n                getString('addsession', 'local_packages');\n            const form = new ModalForm({\n                formClass: 'local_packages\\\\form\\\\session_form',\n                args: {id: element.getAttribute('data-id'),packageid: element.getAttribute('data-packageid'),courseid: element.getAttribute('data-courseid')},\n                modalConfig: {title},\n                returnFocus: element,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, (event) => {\n                event.preventDefault();\n                e.preventDefault();\n                Templates.renderForPromise('local_packages/loader', {}).then(({html, js}) => {\n                    Templates.appendNodeContents('.modal-content', html, js);\n                });\n                window.location.reload();\n            });\n            form.show();\n        }\n        let viewsessions = e.target.closest(Selectors.actions.viewsessions);\n        if (viewsessions) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const packageid = viewsessions.getAttribute('data-packageid');\n            const courseid = viewsessions.getAttribute('data-courseid');\n            const coursename = viewsessions.getAttribute('data-coursename');\n            var options = {};\n            options.packageid = packageid;\n            options.courseid = courseid;\n            var trigger = $(Selectors.actions.viewsessions);\n            ModalFactory.create({\n                title: getString('viewcoursesessions', 'local_packages',coursename),\n                body: Templates.render('local_packages/sessions_display',options)\n            }, trigger)\n            .done(function(modal) {\n                modal.setLarge();\n                modal.show();\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n                }.bind(this));\n            });\n        }\n        \n        let deletesession = e.target.closest(Selectors.actions.deletesession);\n        if (deletesession) {\n            e.preventDefault();\n            const id = deletesession.getAttribute('data-id');\n            const batchname = deletesession.getAttribute('data-batchname')\n            const schedulecode = deletesession.getAttribute('data-schedulecode');\n            var displayparams = {};\n            displayparams.batchname = batchname;\n            displayparams.schedulecode = schedulecode;\n            ModalFactory.create({\n                title: getString('deleteconfirm', 'local_packages'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('sessiondeletebodymessage', 'local_packages', displayparams)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_packages'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    Templates.renderForPromise('local_packages/loader', {}).then(({html, js}) => {\n                        Templates.appendNodeContents('.modal-content', html, js);\n                    });\n                    var params = {};\n                    params.id = id;\n                    var promise = Ajax.call([{\n                        methodname: 'local_packages_deletesession',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n    });\n};\n"],"names":["Selectors","addsessions","viewsessions","deletesession","document","addEventListener","e","element","target","closest","preventDefault","stopImmediatePropagation","title","getAttribute","form","ModalForm","formClass","args","id","packageid","courseid","modalConfig","returnFocus","events","FORM_SUBMITTED","event","renderForPromise","then","_ref2","html","js","appendNodeContents","window","location","reload","show","coursename","options","trigger","$","create","body","Templates","render","done","modal","setLarge","getRoot","on","ModalEvents","hidden","destroy","bind","this","batchname","schedulecode","displayparams","type","ModalFactory","types","SAVE_CANCEL","setSaveButtonText","save","_ref3","params","Ajax","call","methodname","resp","fail","console","log"],"mappings":";;;;;;;kUA4BMA,kBACO,CACLC,YAAa,8BACbC,aAAc,+BACdC,cAAe,+CAkBH,KAChBC,SAASC,iBAAiB,SAAS,SAASC,OACpCC,QAAUD,EAAEE,OAAOC,QAAQT,kBAAkBC,gBAC7CM,QAAS,CACTD,EAAEI,iBACFJ,EAAEK,iCACIC,MAAQL,QAAQM,aAAa,YAC/B,mBAAU,gBAAiB,mBAC3B,mBAAU,aAAc,kBACtBC,KAAO,IAAIC,mBAAU,CACvBC,UAAW,qCACXC,KAAM,CAACC,GAAIX,QAAQM,aAAa,WAAWM,UAAWZ,QAAQM,aAAa,kBAAkBO,SAAUb,QAAQM,aAAa,kBAC5HQ,YAAa,CAACT,MAAAA,OACdU,YAAaf,UAEjBO,KAAKT,iBAAiBS,KAAKS,OAAOC,gBAAiBC,QAC/CA,MAAMf,iBACNJ,EAAEI,oCACQgB,iBAAiB,wBAAyB,IAAIC,MAAKC,YAACC,KAACA,KAADC,GAAOA,6BACvDC,mBAAmB,iBAAkBF,KAAMC,OAEzDE,OAAOC,SAASC,YAEpBpB,KAAKqB,WAELjC,aAAeI,EAAEE,OAAOC,QAAQT,kBAAkBE,iBAClDA,aAAc,CACdI,EAAEI,iBACFJ,EAAEK,iCACIQ,UAAYjB,aAAaW,aAAa,kBACtCO,SAAWlB,aAAaW,aAAa,iBACrCuB,WAAalC,aAAaW,aAAa,uBACzCwB,QAAU,GACdA,QAAQlB,UAAYA,UACpBkB,QAAQjB,SAAWA,aACfkB,QAAUC,EAAEvC,kBAAkBE,qCACrBsC,OAAO,CAChB5B,OAAO,mBAAU,qBAAsB,iBAAiBwB,YACxDK,KAAMC,mBAAUC,OAAO,kCAAkCN,UAC1DC,SACFM,MAAK,SAASC,OACXA,MAAMC,WACND,MAAMV,OACNU,MAAME,UAAUC,GAAGC,sBAAYC,OAAQ,WACvCL,MAAMM,WACJC,KAAKC,cAIXlD,cAAgBG,EAAEE,OAAOC,QAAQT,kBAAkBG,kBACnDA,cAAe,CACfG,EAAEI,uBACIQ,GAAKf,cAAcU,aAAa,WAChCyC,UAAYnD,cAAcU,aAAa,kBACvC0C,aAAepD,cAAcU,aAAa,yBAC5C2C,cAAgB,GACpBA,cAAcF,UAAYA,UAC1BE,cAAcD,aAAeA,oCAChBf,OAAO,CAChB5B,OAAO,mBAAU,gBAAiB,kBAClC6C,KAAMC,uBAAaC,MAAMC,YACzBnB,MAAM,mBAAU,2BAA4B,iBAAkBe,iBAC/DZ,KAAK,SAASC,YACRA,MAAQA,MACbA,MAAMgB,mBAAkB,mBAAU,aAAc,mBAChDhB,MAAME,UAAUC,GAAGC,sBAAYa,KAAM,SAASxD,GAC1CA,EAAEI,oCACQgB,iBAAiB,wBAAyB,IAAIC,MAAKoC,YAAClC,KAACA,KAADC,GAAOA,6BACvDC,mBAAmB,iBAAkBF,KAAMC,WAErDkC,OAAS,GACbA,OAAO9C,GAAKA,GACE+C,cAAKC,KAAK,CAAC,CACrBC,WAAY,+BACZlD,KAAM+C,UAEF,GAAGpB,MAAK,SAASwB,MACrBpC,OAAOC,SAASC,QAAO,MACxBmC,MAAK,WACJC,QAAQC,IAAI,iBAElBnB,KAAKC,OACPR,MAAMV,QACRiB,KAAKC"}